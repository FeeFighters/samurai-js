<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>payment_error_handler.js.coffee</title>

  <link href="/assets/docs.css" media="screen" rel="stylesheet" type="text/css" />


  
    <script type="text/javascript" src="https://use.typekit.com/yxg1bfk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  
</head>
<body class='code-documentation'>
  <header>
    <h1 class="logo">
            <a href="/" class="samurai"><span class="ir mark"></span><span class="ir home"></span><span class="ir type">Samurai</span></a>
            <span class="by">by</span>
            <a href="http://feefighters.com" class="ir feefighters">FeeFighters</a>
     </h1>

    <nav class='subnav'>
      <ul>
         <li><a href="/">Home</a></li>
         <li><a href="/about">About</a></li>
         <li><a href="/pricing">Pricing</a></li>
         <li><a href="/features">Features</a></li>
         <li><a href="http://samurai-support.feefighters.com/">Support</a></li>
      </ul>
    </nav>

    <nav class="developers">
      <ul>
        <li><a href="/developers"><span class="icon">Developers</span></a></li>
      </ul>
    </nav>

    <div></div>
  </header>

  
    <div id="section_jump">
      Jump To
      <div id="section_jump_wrapper">
        <div id="section_page">
          <a href="/developers/samurai-js/docs/" class="source">Table of Contents</a>
          
            
            <a class="source" href="../samurai.js.coffee.html">0.1/samurai.js.coffee</a>
          
            
            <a class="source" href="base.js.coffee.html">0.1/samurai/base.js.coffee</a>
          
            
            <a class="source" href="card_preview.js.coffee.html">0.1/samurai/card_preview.js.coffee</a>
          
            
            <a class="source" href="events.js.coffee.html">0.1/samurai/events.js.coffee</a>
          
            
            <a class="source" href="expiration_dates.js.coffee.html">0.1/samurai/expiration_dates.js.coffee</a>
          
            
            <a class="source" href="payment_error_handler.js.coffee.html">0.1/samurai/payment_error_handler.js.coffee</a>
          
            
            <a class="source" href="payment_forms.js.coffee.html">0.1/samurai/payment_forms.js.coffee</a>
          
            
            <a class="source" href="payments.js.coffee.html">0.1/samurai/payments.js.coffee</a>
          
            
            <a class="source" href="utilities.js.coffee.html">0.1/samurai/utilities.js.coffee</a>
          
            
            <a class="source" href="../../samurai.js.coffee.html">samurai.js.coffee</a>
          
        </div>
      </div>
    </div>
  

  <nav class="breadcrumb">
    <div class="wrapper">
      <a href="/developers">Developer Resources</a> <span class="arrow">&gt;</span>
      <a href="/developers/samurai-js">Samurai.js</a> <span class="arrow">&gt;</span>
      <a href="/developers/samurai-js/docs">Code Documentation</a> <span class="arrow">&gt;</span>
      <span class="current">payment_error_handler.js.coffee</span>
    </div>
  </nav>

  <div id='container'>
    <div id="background"></div>

    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>payment_error_handler.js.coffee</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
      
      <tr id='section-Samurai_Payment_Error_Handler_Module'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-Samurai_Payment_Error_Handler_Module">&#182;</a>
          </div>
          <h2>Samurai Payment Error Handler Module</h2>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-2'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-2">&#182;</a>
          </div>
          <p>Module for handling errors returned by the Samurai Payment module</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-3'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-3">&#182;</a>
          </div>
          <p>Transaction Responses</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-4'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-4">&#182;</a>
          </div>
          <p>CVV Responses</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-5'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-5">&#182;</a>
          </div>
          <p>Input validations</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-6'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-6">&#182;</a>
          </div>
          <p>Keeps a list of all instantiated error handlers.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-7'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-7">&#182;</a>
          </div>
          <p>Used to return a reference to the error handler of a form or
instantiate one if one doesn&#39;t exist, yet.
Make sure that the <code>element</code> argument is an actual DOM element
and not a jQuery collection.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-8'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-8">&#182;</a>
          </div>
          <p>Deprecated because of reserved word use. Will be removed in v0.2</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-9'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-9">&#182;</a>
          </div>
          <p>Setup the error handler for <code>@form</code> and respond to the payment,
submit and show-error events.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-10'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-10">&#182;</a>
          </div>
          <p>You can pass your own config values to the constructor
if you&#39;re planning to let Samurai handle the display of errors,
but would just like to use different class names.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-11'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-11">&#182;</a>
          </div>
          <p>This method simply passes the response on to the <code>handleErrorsFromResponse</code> method
in its default implementation, but you can always replace it with your own if you
need it to do more than that.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-12'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-12">&#182;</a>
          </div>
          <p>Loops through the messages block and calls the <code>parseErrorMessage</code> method
for each message with a class of <code>error</code>. At the end of the method,
a <code>errors-shown</code> event is triggered, which we hook into to
provide users a summary of all errors.</p>

<p>This method will usually get called by handlePaymentEvent when a <code>payment</code> event
is triggered, but you can easily use it on its own like this:</p>

<p><code>Samurai.PaymentErrorHandler.forForm($(&#39;#myform&#39;).get(0)).handleErrorsFromResponse(jsonResponse)</code></p>

<p>Note that this method doesn&#39;t handle the display of errors.
When it finds an error, it triggers the <code>show-error</code> event and passes on
the affected input field and the humanized error message. This allows you to
intercept the <code>show-error</code> event and handle the display of errors yourself.
If not, the built-in <code>highlightFieldWithError</code> method will respond to this event
and highlight the erroneous field in the default style.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-13'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-13">&#182;</a>
          </div>
          <p>Sort the messages so that we handle the higher-priority messages first</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-14'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-14">&#182;</a>
          </div>
          <p>Make sure the errors are unique&#39;d, by message.context</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-15'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-15">&#182;</a>
          </div>
          <p>Performs a deep traversal of the response object, and looks for
message arrays along the way. This method is needed because sometimes
you can have both the payment_method and processor responses in the same
JSON object, each with their own respective messages array. This method
saves you from having to remember the paths to these message arrays and
lumps all messages together.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-16'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-16">&#182;</a>
          </div>
          <p>sometimes a message is returned as a shallow object in an array of messages,
sometimes it&#39;s inside an additional <code>message</code> object wrapper. This expression
makes sure the two are the same.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-17'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-17">&#182;</a>
          </div>
          <p>Returns the error context, a jQuery collection that contains the element with invalid value
(if there is one) and the humanized error text that corresponds to the message key</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-18'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-18">&#182;</a>
          </div>
          <p>The default error renderer for Samurai. Adds the <code>error</code> class names to the
input field and its nearest label.
It also triggers an <code>error-shown</code> event after these changes with the affected input element
and the error message as arguments.</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-19'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-19">&#182;</a>
          </div>
          <p>Make sure the errors are unique&#39;d</p>
        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
      <tr id='section-20'>
        <td class=docs>
          <div class="pilwrap">
            <a class="pilcrow" href="#section-20">&#182;</a>
          </div>
          <p>Clears all errors and wipe the internal error message array.</p>

        </td>
        <td class=code>
          <div class='highlight'><pre></pre></div>
        </td>
      </tr>
      
    </table>
  </div>
</body>
</html>